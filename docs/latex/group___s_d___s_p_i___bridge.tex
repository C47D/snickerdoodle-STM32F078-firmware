\hypertarget{group___s_d___s_p_i___bridge}{}\section{S\+PI Bridge}
\label{group___s_d___s_p_i___bridge}\index{S\+P\+I Bridge@{S\+P\+I Bridge}}


Bridging from S\+PI to other peripherals.  


\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structsd__spbr__cmd}{sd\+\_\+spbr\+\_\+cmd}}
\begin{DoxyCompactList}\small\item\em S\+PI bridge device operation structure. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structsd__spbr__dev}{sd\+\_\+spbr\+\_\+dev}}
\begin{DoxyCompactList}\small\item\em S\+PI bridge device structure. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structsd__spbr}{sd\+\_\+spbr}}
\begin{DoxyCompactList}\small\item\em S\+PI bridge structure. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga98bb51ae4436b20910e2da1093e1fb4e}\label{group___s_d___s_p_i___bridge_ga98bb51ae4436b20910e2da1093e1fb4e}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+N\+D\+EV}~(3)
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_gad016b41dcc88c418480b2350a657c2d8}\label{group___s_d___s_p_i___bridge_gad016b41dcc88c418480b2350a657c2d8}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+I2\+C\+\_\+\+S\+T\+A\+T\+US}~((uint8\+\_\+t)(1 $<$$<$ 0))
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga85c8cbe45773ed01124193386845d823}\label{group___s_d___s_p_i___bridge_ga85c8cbe45773ed01124193386845d823}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+L\+E\+D\+\_\+\+S\+T\+A\+T\+US}~((uint8\+\_\+t)(1 $<$$<$ 1))
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_gad7d58d6fc704c74b58fd6462431a350d}\label{group___s_d___s_p_i___bridge_gad7d58d6fc704c74b58fd6462431a350d}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+U\+A\+R\+T\+\_\+\+S\+T\+A\+T\+US}~((uint8\+\_\+t)(1 $<$$<$ 2))
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga59e1279217436eeb3199a07afceebe20}\label{group___s_d___s_p_i___bridge_ga59e1279217436eeb3199a07afceebe20}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+D\+E\+V\+\_\+\+M\+A\+SK}~(0x\+F8)
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga555ad1faec4521d7b0bb394bb9cab9bd}\label{group___s_d___s_p_i___bridge_ga555ad1faec4521d7b0bb394bb9cab9bd}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+I2\+C\+\_\+\+D\+EV}~(0x80)
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga1f3e4e48ed33b5e21914820a6090ec54}\label{group___s_d___s_p_i___bridge_ga1f3e4e48ed33b5e21914820a6090ec54}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+C\+M\+D\+\_\+\+M\+A\+SK}~(0x\+E0)
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_gabebfa50f216c2717e870b62b00dbad4e}\label{group___s_d___s_p_i___bridge_gabebfa50f216c2717e870b62b00dbad4e}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+I2\+C\+\_\+\+R\+W\+\_\+\+C\+MD}~(0x\+A0)
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga2a2d3e023a52839574ddd2276898b5e5}\label{group___s_d___s_p_i___bridge_ga2a2d3e023a52839574ddd2276898b5e5}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+I2\+C\+\_\+\+R\+E\+A\+D\+\_\+\+T\+R\+A\+NS}~((uint8\+\_\+t)(1 $<$$<$ 2))
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga6c774e1c2f502f1d9ac985ac3b6d7811}\label{group___s_d___s_p_i___bridge_ga6c774e1c2f502f1d9ac985ac3b6d7811}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+I2\+C\+\_\+\+A\+D\+D\+R\+\_\+10\+B\+IT}~((uint8\+\_\+t)(1 $<$$<$ 3))
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga2adf7c03a6fd8698f05caf36617ce6e8}\label{group___s_d___s_p_i___bridge_ga2adf7c03a6fd8698f05caf36617ce6e8}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+I2\+C\+\_\+\+F\+R\+E\+Q\+\_\+400K}~((uint8\+\_\+t)(1 $<$$<$ 4))
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga178aed651051089877988d1490f7a5f5}\label{group___s_d___s_p_i___bridge_ga178aed651051089877988d1490f7a5f5}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+N\+U\+L\+L\+\_\+\+D\+EV}~\{ 0, N\+U\+LL, N\+U\+LL \}
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga0128d3caf1341fce17385cd6d033efec}\label{group___s_d___s_p_i___bridge_ga0128d3caf1341fce17385cd6d033efec}} 
\#define {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+N\+U\+L\+L\+\_\+\+OP}~\{ 0, N\+U\+LL, N\+U\+LL \}
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga1fa0fc366d8cfa91ffb1143044ace760}\label{group___s_d___s_p_i___bridge_ga1fa0fc366d8cfa91ffb1143044ace760}} 
enum {\bfseries sd\+\_\+spbr\+\_\+state} \{ {\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+R\+E\+A\+D\+\_\+\+D\+E\+V\+I\+CE}, 
{\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+R\+E\+A\+D\+\_\+\+C\+MD}, 
{\bfseries S\+D\+\_\+\+S\+P\+B\+R\+\_\+\+I\+N\+\_\+\+P\+R\+O\+C\+E\+SS}
 \}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \mbox{\hyperlink{group___s_d___s_p_i___bridge_ga303d9b609ad91e21cf2d9ae010dc620d}{sd\+\_\+spbr\+\_\+rx\+\_\+isr}} (struct \mbox{\hyperlink{structsd__spbr}{sd\+\_\+spbr}} $\ast$spbr)
\begin{DoxyCompactList}\small\item\em S\+PI Bridge Receive Interrupt Routine. \end{DoxyCompactList}\item 
static struct \mbox{\hyperlink{structsd__spbr__dev}{sd\+\_\+spbr\+\_\+dev}} $\ast$ \mbox{\hyperlink{group___s_d___s_p_i___bridge_gaf2de23902fa458c64da619f83a31d7ec}{sd\+\_\+spbr\+\_\+find\+\_\+device}} (struct \mbox{\hyperlink{structsd__spbr__dev}{sd\+\_\+spbr\+\_\+dev}} $\ast$head, uint8\+\_\+t id)
\begin{DoxyCompactList}\small\item\em S\+PI Bridge Find Device Searches a sentinel terminated table pointed to by head for a matching ID and returns a pointer to the device or N\+U\+LL. \end{DoxyCompactList}\item 
static struct \mbox{\hyperlink{structsd__spbr__cmd}{sd\+\_\+spbr\+\_\+cmd}} $\ast$ \mbox{\hyperlink{group___s_d___s_p_i___bridge_ga2b5f70f500fea4bd4b79b8788ba6e03d}{sd\+\_\+spbr\+\_\+find\+\_\+cmd}} (struct \mbox{\hyperlink{structsd__spbr__cmd}{sd\+\_\+spbr\+\_\+cmd}} $\ast$head, uint8\+\_\+t opcode)
\begin{DoxyCompactList}\small\item\em S\+PI Bridge Find Command Searches a sentinel terminated table pointed to by head for a matching ID and returns a pointer to the device or N\+U\+LL. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group___s_d___s_p_i___bridge_gaea5b9346a7e4095cda1e056ca703ef89}{sd\+\_\+spbr\+\_\+init}} (struct \mbox{\hyperlink{structsd__spbr}{sd\+\_\+spbr}} $\ast$spbr, S\+P\+I\+\_\+\+Handle\+Type\+Def $\ast$spi)
\begin{DoxyCompactList}\small\item\em S\+PI Bridge Initialize. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group___s_d___s_p_i___bridge_ga0ce7728ffce92e9931c22b9c54675ca7}{sd\+\_\+spbr\+\_\+irqhandler}} (struct \mbox{\hyperlink{structsd__spbr}{sd\+\_\+spbr}} $\ast$spbr)
\begin{DoxyCompactList}\small\item\em S\+PI Bridge Interrupt Handler Handle interrupt events on the S\+PI peripheral. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_gae38f302a3033c610bf39100302e35677}\label{group___s_d___s_p_i___bridge_gae38f302a3033c610bf39100302e35677}} 
struct \mbox{\hyperlink{structsd__spbr}{sd\+\_\+spbr}} {\bfseries spi2\+\_\+spbr}
\item 
static struct \mbox{\hyperlink{structsd__spbr__dev}{sd\+\_\+spbr\+\_\+dev}} {\bfseries spbr\+\_\+dev\+\_\+tab} \mbox{[}$\,$\mbox{]}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Bridging from S\+PI to other peripherals. 



\subsection{Function Documentation}
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga2b5f70f500fea4bd4b79b8788ba6e03d}\label{group___s_d___s_p_i___bridge_ga2b5f70f500fea4bd4b79b8788ba6e03d}} 
\index{S\+P\+I Bridge@{S\+P\+I Bridge}!sd\+\_\+spbr\+\_\+find\+\_\+cmd@{sd\+\_\+spbr\+\_\+find\+\_\+cmd}}
\index{sd\+\_\+spbr\+\_\+find\+\_\+cmd@{sd\+\_\+spbr\+\_\+find\+\_\+cmd}!S\+P\+I Bridge@{S\+P\+I Bridge}}
\subsubsection{\texorpdfstring{sd\+\_\+spbr\+\_\+find\+\_\+cmd()}{sd\_spbr\_find\_cmd()}}
{\footnotesize\ttfamily static struct \mbox{\hyperlink{structsd__spbr__cmd}{sd\+\_\+spbr\+\_\+cmd}}$\ast$ sd\+\_\+spbr\+\_\+find\+\_\+cmd (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structsd__spbr__cmd}{sd\+\_\+spbr\+\_\+cmd}} $\ast$}]{head,  }\item[{uint8\+\_\+t}]{opcode }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



{\ttfamily \#include $<$\mbox{\hyperlink{sd__spi__bridge_8c}{Src/sd\+\_\+spi\+\_\+bridge.\+c}}$>$}



S\+PI Bridge Find Command Searches a sentinel terminated table pointed to by head for a matching ID and returns a pointer to the device or N\+U\+LL. 

\begin{DoxyNote}{Note}
To speed up the loops, this function expects the device mask be applied to the id before it is passed to this function.
\end{DoxyNote}

\begin{DoxyParams}{Parameters}
{\em head} & Pointer to head of table for searching \\
\hline
{\em id} & ID value to search for \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em Pointer} & to matching device or N\+U\+LL if not found \\
\hline
\end{DoxyRetVals}

\begin{DoxyCode}
114 \{
115     \textcolor{keyword}{struct }\mbox{\hyperlink{structsd__spbr__cmd}{sd\_spbr\_cmd}} *pcmd = head;
116     
117     \textcolor{keywordflow}{while} ((pcmd != NULL) && (pcmd->opcode > 0)) \{
118         \textcolor{keywordflow}{if} (pcmd->opcode == opcode)
119             \textcolor{keywordflow}{return} pcmd;
120             
121         pcmd++;
122     \}
123     
124     \textcolor{keywordflow}{return} NULL;
125 \}
\end{DoxyCode}
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_gaf2de23902fa458c64da619f83a31d7ec}\label{group___s_d___s_p_i___bridge_gaf2de23902fa458c64da619f83a31d7ec}} 
\index{S\+P\+I Bridge@{S\+P\+I Bridge}!sd\+\_\+spbr\+\_\+find\+\_\+device@{sd\+\_\+spbr\+\_\+find\+\_\+device}}
\index{sd\+\_\+spbr\+\_\+find\+\_\+device@{sd\+\_\+spbr\+\_\+find\+\_\+device}!S\+P\+I Bridge@{S\+P\+I Bridge}}
\subsubsection{\texorpdfstring{sd\+\_\+spbr\+\_\+find\+\_\+device()}{sd\_spbr\_find\_device()}}
{\footnotesize\ttfamily static struct \mbox{\hyperlink{structsd__spbr__dev}{sd\+\_\+spbr\+\_\+dev}}$\ast$ sd\+\_\+spbr\+\_\+find\+\_\+device (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structsd__spbr__dev}{sd\+\_\+spbr\+\_\+dev}} $\ast$}]{head,  }\item[{uint8\+\_\+t}]{id }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



{\ttfamily \#include $<$\mbox{\hyperlink{sd__spi__bridge_8c}{Src/sd\+\_\+spi\+\_\+bridge.\+c}}$>$}



S\+PI Bridge Find Device Searches a sentinel terminated table pointed to by head for a matching ID and returns a pointer to the device or N\+U\+LL. 

\begin{DoxyNote}{Note}
To speed up the loops, this function expects the device mask be applied to the id before it is passed to this function.
\end{DoxyNote}

\begin{DoxyParams}{Parameters}
{\em head} & Pointer to head of table for searching \\
\hline
{\em id} & ID value to search for \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em Pointer} & to matching device or N\+U\+LL if not found \\
\hline
\end{DoxyRetVals}

\begin{DoxyCode}
87 \{
88     \textcolor{keyword}{struct }\mbox{\hyperlink{structsd__spbr__dev}{sd\_spbr\_dev}} *pdev = head;
89 
90     \textcolor{keywordflow}{while} ((pdev != NULL) && (pdev->\mbox{\hyperlink{structsd__spbr__dev_a1e6927fa1486224044e568f9c370519b}{id}} > 0)) \{
91         \textcolor{keywordflow}{if} (pdev->\mbox{\hyperlink{structsd__spbr__dev_a1e6927fa1486224044e568f9c370519b}{id}} == \textcolor{keywordtype}{id})
92             \textcolor{keywordflow}{return} pdev;
93             
94         pdev++;
95     \}
96 
97     \textcolor{keywordflow}{return} NULL;
98 \}
\end{DoxyCode}
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_gaea5b9346a7e4095cda1e056ca703ef89}\label{group___s_d___s_p_i___bridge_gaea5b9346a7e4095cda1e056ca703ef89}} 
\index{S\+P\+I Bridge@{S\+P\+I Bridge}!sd\+\_\+spbr\+\_\+init@{sd\+\_\+spbr\+\_\+init}}
\index{sd\+\_\+spbr\+\_\+init@{sd\+\_\+spbr\+\_\+init}!S\+P\+I Bridge@{S\+P\+I Bridge}}
\subsubsection{\texorpdfstring{sd\+\_\+spbr\+\_\+init()}{sd\_spbr\_init()}}
{\footnotesize\ttfamily void sd\+\_\+spbr\+\_\+init (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structsd__spbr}{sd\+\_\+spbr}} $\ast$}]{spbr,  }\item[{S\+P\+I\+\_\+\+Handle\+Type\+Def $\ast$}]{spi }\end{DoxyParamCaption})}



{\ttfamily \#include $<$\mbox{\hyperlink{sd__spi__bridge_8c}{Src/sd\+\_\+spi\+\_\+bridge.\+c}}$>$}



S\+PI Bridge Initialize. 


\begin{DoxyParams}{Parameters}
{\em spbr} & Pointer to S\+PI bridge structure to initialize \\
\hline
{\em spi} & S\+PI handle to use for bridge \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em None} & \\
\hline
\end{DoxyRetVals}

\begin{DoxyCode}
136 \{
137 
138     \textcolor{comment}{/* Reset the UART device structure */}
139     memset(spbr, 0, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \mbox{\hyperlink{structsd__spbr}{sd\_spbr}}));
140     
141     spbr->spi = spi;
142 
143     \textcolor{comment}{/* Prepare the peripheral to receive */}
144     \textcolor{comment}{/* Enable RXNE and ERR interrupt */}
145     \_\_HAL\_SPI\_ENABLE\_IT(spi, (SPI\_IT\_RXNE | SPI\_IT\_ERR));
146 
147     \textcolor{comment}{/* Check if the SPI is already enabled */}
148     \textcolor{keywordflow}{if} ((spi->Instance->CR1 & SPI\_CR1\_SPE) != SPI\_CR1\_SPE)
149         \_\_HAL\_SPI\_ENABLE(spi);         \textcolor{comment}{/* Enable SPI peripheral */}
150 
151     spbr->\mbox{\hyperlink{structsd__spbr_a15ddc1ec640d62f5f08410710d83de8a}{state}} = SD\_SPBR\_READ\_DEVICE;
152 \}
\end{DoxyCode}
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga0ce7728ffce92e9931c22b9c54675ca7}\label{group___s_d___s_p_i___bridge_ga0ce7728ffce92e9931c22b9c54675ca7}} 
\index{S\+P\+I Bridge@{S\+P\+I Bridge}!sd\+\_\+spbr\+\_\+irqhandler@{sd\+\_\+spbr\+\_\+irqhandler}}
\index{sd\+\_\+spbr\+\_\+irqhandler@{sd\+\_\+spbr\+\_\+irqhandler}!S\+P\+I Bridge@{S\+P\+I Bridge}}
\subsubsection{\texorpdfstring{sd\+\_\+spbr\+\_\+irqhandler()}{sd\_spbr\_irqhandler()}}
{\footnotesize\ttfamily void sd\+\_\+spbr\+\_\+irqhandler (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structsd__spbr}{sd\+\_\+spbr}} $\ast$}]{spbr }\end{DoxyParamCaption})}



{\ttfamily \#include $<$\mbox{\hyperlink{sd__spi__bridge_8c}{Src/sd\+\_\+spi\+\_\+bridge.\+c}}$>$}



S\+PI Bridge Interrupt Handler Handle interrupt events on the S\+PI peripheral. 


\begin{DoxyParams}{Parameters}
{\em spbr} & Pointer to S\+PI bridge structure \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em None} & \\
\hline
\end{DoxyRetVals}

\begin{DoxyCode}
163 \{
164     SPI\_HandleTypeDef *spi = spbr->spi;
165 
166     uint32\_t itsource = spi->Instance->CR2;
167     uint32\_t itflag   = spi->Instance->SR;
168 
169     \textcolor{comment}{/*---------------------- SPI in mode Receiver ------------------------*/}
170     \textcolor{keywordflow}{if} (((itflag & SPI\_FLAG\_OVR) == RESET) &&
171         ((itflag & SPI\_FLAG\_RXNE) != RESET) && 
172         ((itsource & SPI\_IT\_RXNE) != RESET)) \{
173         \mbox{\hyperlink{group___s_d___s_p_i___bridge_ga303d9b609ad91e21cf2d9ae010dc620d}{sd\_spbr\_rx\_isr}}(spbr);
174         \textcolor{keywordflow}{return};
175     \}
176 
177     \textcolor{comment}{/*--------------------- SPI in mode Transmitter ----------------------*/}
178     \textcolor{keywordflow}{if} (((itflag & SPI\_FLAG\_TXE) != RESET) && 
179         ((itsource & SPI\_IT\_TXE) != RESET)) \{
180         spi->TxISR(spi);
181         \textcolor{keywordflow}{return};
182     \}
183 
184     \textcolor{comment}{/*-------------------- SPI in Error Treatment ------------------------*/}
185     \textcolor{keywordflow}{if} ((itflag & (SPI\_FLAG\_MODF | SPI\_FLAG\_OVR | SPI\_FLAG\_FRE)) != RESET) \{
186         \textcolor{comment}{/* SPI Overrun error interrupt occurred */}
187         \textcolor{keywordflow}{if} ((itflag & SPI\_FLAG\_OVR) != RESET) \{
188             \textcolor{keywordflow}{if} (spi->State != HAL\_SPI\_STATE\_BUSY\_TX) \{
189                 spi->ErrorCode |= HAL\_SPI\_ERROR\_OVR;
190                 \_\_HAL\_SPI\_CLEAR\_OVRFLAG(spi);
191             \} \textcolor{keywordflow}{else} \{
192                 \textcolor{keywordflow}{return};
193             \}
194         \}
195 
196         \textcolor{comment}{/* SPI Mode Fault error interrupt occurred */}
197         \textcolor{keywordflow}{if} ((itflag & SPI\_FLAG\_MODF) != RESET) \{
198             spi->ErrorCode |= HAL\_SPI\_ERROR\_MODF;
199             \_\_HAL\_SPI\_CLEAR\_MODFFLAG(spi);
200         \}
201 
202         \textcolor{comment}{/* SPI Frame error interrupt occurred */}
203         \textcolor{keywordflow}{if} ((itflag & SPI\_FLAG\_FRE) != RESET) \{
204             spi->ErrorCode |= HAL\_SPI\_ERROR\_FRE;
205             \_\_HAL\_SPI\_CLEAR\_FREFLAG(spi);
206         \}
207 
208         \_\_HAL\_SPI\_DISABLE\_IT(spi, SPI\_IT\_RXNE | SPI\_IT\_TXE | SPI\_IT\_ERR);
209         spi->State = HAL\_SPI\_STATE\_READY;
210         \textcolor{keywordflow}{return};
211     \}
212 \}
\end{DoxyCode}
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga303d9b609ad91e21cf2d9ae010dc620d}\label{group___s_d___s_p_i___bridge_ga303d9b609ad91e21cf2d9ae010dc620d}} 
\index{S\+P\+I Bridge@{S\+P\+I Bridge}!sd\+\_\+spbr\+\_\+rx\+\_\+isr@{sd\+\_\+spbr\+\_\+rx\+\_\+isr}}
\index{sd\+\_\+spbr\+\_\+rx\+\_\+isr@{sd\+\_\+spbr\+\_\+rx\+\_\+isr}!S\+P\+I Bridge@{S\+P\+I Bridge}}
\subsubsection{\texorpdfstring{sd\+\_\+spbr\+\_\+rx\+\_\+isr()}{sd\_spbr\_rx\_isr()}}
{\footnotesize\ttfamily static void sd\+\_\+spbr\+\_\+rx\+\_\+isr (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structsd__spbr}{sd\+\_\+spbr}} $\ast$}]{spbr }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



{\ttfamily \#include $<$\mbox{\hyperlink{sd__spi__bridge_8c}{Src/sd\+\_\+spi\+\_\+bridge.\+c}}$>$}



S\+PI Bridge Receive Interrupt Routine. 


\begin{DoxyParams}{Parameters}
{\em spbr} & Pointer to S\+PI bridge structure \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em None} & \\
\hline
\end{DoxyRetVals}

\begin{DoxyCode}
222 \{
223     uint8\_t data = (uint8\_t)(spbr->spi->Instance->DR);
224 
225     \textcolor{keywordflow}{switch} (spbr->\mbox{\hyperlink{structsd__spbr_a15ddc1ec640d62f5f08410710d83de8a}{state}}) \{
226     \textcolor{keywordflow}{case} SD\_SPBR\_READ\_DEVICE:
227     
228         \textcolor{comment}{/* Find the device from the table */}
229         spbr->\mbox{\hyperlink{structsd__spbr_ab3464a17b25faba49ad79ea9c48ea46f}{curr\_dev}} = \mbox{\hyperlink{group___s_d___s_p_i___bridge_gaf2de23902fa458c64da619f83a31d7ec}{sd\_spbr\_find\_device}}(spbr\_dev\_tab, data & 
      SD\_SPBR\_DEV\_MASK);
230         \textcolor{keywordflow}{if} (spbr->\mbox{\hyperlink{structsd__spbr_ab3464a17b25faba49ad79ea9c48ea46f}{curr\_dev}} == NULL)
231             \textcolor{keywordflow}{return};
232             
233         \textcolor{comment}{/* Run callback for device, if one exists */}
234         \textcolor{keywordflow}{if} (spbr->\mbox{\hyperlink{structsd__spbr_ab3464a17b25faba49ad79ea9c48ea46f}{curr\_dev}}->\mbox{\hyperlink{structsd__spbr__dev_a3e035473248af7cdffca805f540617c8}{dev\_start}} != NULL)
235             spbr->\mbox{\hyperlink{structsd__spbr_ab3464a17b25faba49ad79ea9c48ea46f}{curr\_dev}}->\mbox{\hyperlink{structsd__spbr__dev_a3e035473248af7cdffca805f540617c8}{dev\_start}}(&data);
236             
237         \textcolor{comment}{/* Set the device ID in the transmit buffer */}
238         HAL\_SPI\_Transmit\_IT(spbr->spi, &data, 1);
239         
240         spbr->\mbox{\hyperlink{structsd__spbr_a15ddc1ec640d62f5f08410710d83de8a}{state}} = SD\_SPBR\_READ\_CMD;
241         \textcolor{keywordflow}{break};
242     
243     \textcolor{keywordflow}{case} SD\_SPBR\_READ\_CMD:
244     
245         spbr->\mbox{\hyperlink{structsd__spbr_ab3464a17b25faba49ad79ea9c48ea46f}{curr\_dev}}->\mbox{\hyperlink{structsd__spbr__dev_a3217f31b08eb084b2c943abd2af5ca8b}{curr\_cmd}} = \mbox{\hyperlink{group___s_d___s_p_i___bridge_ga2b5f70f500fea4bd4b79b8788ba6e03d}{sd\_spbr\_find\_cmd}}(spbr->
      \mbox{\hyperlink{structsd__spbr_ab3464a17b25faba49ad79ea9c48ea46f}{curr\_dev}}->\mbox{\hyperlink{structsd__spbr__dev_acf35c83b2010d52c70fcc6b3db393bc6}{cmds}}, 
246                                 (data & SD\_SPBR\_CMD\_MASK));
247                                 
248         \textcolor{keywordflow}{if} (spbr->\mbox{\hyperlink{structsd__spbr_ab3464a17b25faba49ad79ea9c48ea46f}{curr\_dev}}->\mbox{\hyperlink{structsd__spbr__dev_a3217f31b08eb084b2c943abd2af5ca8b}{curr\_cmd}} == NULL) \{
249             \textcolor{comment}{/* A matching command from the device list was not found}
250 \textcolor{comment}{             * This is an exception that needs to be handled}
251 \textcolor{comment}{             */}
252             spbr->\mbox{\hyperlink{structsd__spbr_a15ddc1ec640d62f5f08410710d83de8a}{state}} = SD\_SPBR\_READ\_DEVICE;
253             \textcolor{keywordflow}{return};
254         \}
255         
256         \textcolor{keywordflow}{if} (spbr->\mbox{\hyperlink{structsd__spbr_ab3464a17b25faba49ad79ea9c48ea46f}{curr\_dev}}->\mbox{\hyperlink{structsd__spbr__dev_a3217f31b08eb084b2c943abd2af5ca8b}{curr\_cmd}} != NULL)
257             spbr->\mbox{\hyperlink{structsd__spbr_ab3464a17b25faba49ad79ea9c48ea46f}{curr\_dev}}->\mbox{\hyperlink{structsd__spbr__dev_a3217f31b08eb084b2c943abd2af5ca8b}{curr\_cmd}}->start(&data);
258             
259         \textcolor{comment}{/* Set the device ID in the transmit buffer */}
260         HAL\_SPI\_Transmit\_IT(spbr->spi, &data, 1);
261         
262         spbr->\mbox{\hyperlink{structsd__spbr_a15ddc1ec640d62f5f08410710d83de8a}{state}} = SD\_SPBR\_IN\_PROCESS;
263     
264         \textcolor{keywordflow}{break};
265         
266     \textcolor{keywordflow}{case} SD\_SPBR\_IN\_PROCESS:
267     
268     
269         \textcolor{keywordflow}{break};
270     \}
271 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{group___s_d___s_p_i___bridge_ga1428a2a8c7adc3e1489417b8fe4508ba}\label{group___s_d___s_p_i___bridge_ga1428a2a8c7adc3e1489417b8fe4508ba}} 
\index{S\+P\+I Bridge@{S\+P\+I Bridge}!spbr\+\_\+dev\+\_\+tab@{spbr\+\_\+dev\+\_\+tab}}
\index{spbr\+\_\+dev\+\_\+tab@{spbr\+\_\+dev\+\_\+tab}!S\+P\+I Bridge@{S\+P\+I Bridge}}
\subsubsection{\texorpdfstring{spbr\+\_\+dev\+\_\+tab}{spbr\_dev\_tab}}
{\footnotesize\ttfamily struct \mbox{\hyperlink{structsd__spbr__dev}{sd\+\_\+spbr\+\_\+dev}} spbr\+\_\+dev\+\_\+tab\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}



{\ttfamily \#include $<$\mbox{\hyperlink{sd__spi__bridge_8c}{Src/sd\+\_\+spi\+\_\+bridge.\+c}}$>$}

{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    \{ SD\_SPBR\_I2C\_DEV, NULL, NULL \},
    SD\_SPBR\_NULL\_DEV
\}
\end{DoxyCode}
